<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Archangels MC - Mapa</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #fff;
    }
    #sidebar {
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      width: 280px;
      background: #1a1a1a;
      overflow-y: auto;
      z-index: 10;
      border-right: 2px solid #222;
      padding: 20px;
    }
    #sidebar h1 {
      font-size: 20px;
      margin-bottom: 20px;
      color: #ff5050;
    }
    .category {
      margin-bottom: 10px;
    }
    .category h2 {
      cursor: pointer;
      margin: 10px 0;
      font-size: 16px;
      border-bottom: 1px solid #333;
      padding-bottom: 5px;
    }
    .category-items {
      display: none;
      margin-left: 10px;
    }
    .item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
      margin: 5px 0;
      cursor: pointer;
    }
    .dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }
    .delete-btn {
      color: #888;
      font-size: 12px;
      cursor: pointer;
    }
    #map {
      position: absolute;
      top: 0;
      left: 280px;
      right: 0;
      bottom: 0;
      background: #000 url('mapa.png') no-repeat center center;
      background-size: contain;
      cursor: grab;
    }
    .marker, .polygon {
      position: absolute;
      transform: translate(-50%, -50%);
      cursor: pointer;
    }
    .marker {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      border: 2px solid white;
    }
    .tooltip {
      position: absolute;
      background: rgba(0,0,0,0.8);
      color: #fff;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      pointer-events: none;
      white-space: nowrap;
      z-index: 99;
    }
  </style>
</head>
<body>
  <div id="sidebar">
    <h1>Archangels MC</h1>
    <div class="category" data-cat="Lokace">
      <h2 onclick="toggleCategory(this)">üìç Lokace</h2>
      <div class="category-items" id="cat-Lokace"></div>
    </div>
    <div class="category" data-cat="√özem√≠">
      <h2 onclick="toggleCategory(this)">üó∫Ô∏è √özem√≠</h2>
      <div class="category-items" id="cat-√özem√≠"></div>
    </div>
    <div class="category" data-cat="Dod√°vky">
      <h2 onclick="toggleCategory(this)">üì¶ Dod√°vky</h2>
      <div class="category-items" id="cat-Dod√°vky"></div>
    </div>
  </div>
  <div id="map"></div>
  <script>
    const map = document.getElementById('map');
    let data = JSON.parse(localStorage.getItem('archangels_map') || '[]');
    let currentPolygon = [];
    let scale = 1, originX = 0, originY = 0, isDragging = false, dragStart;

    function saveData() {
      localStorage.setItem('archangels_map', JSON.stringify(data));
    }

    function toggleCategory(header) {
      const content = header.nextElementSibling;
      content.style.display = content.style.display === 'block' ? 'none' : 'block';
    }

    function renderAll() {
      document.querySelectorAll('.marker, .polygon').forEach(e => e.remove());
      ['Lokace','√özem√≠','Dod√°vky'].forEach(cat => {
        const container = document.getElementById('cat-' + cat);
        container.innerHTML = '';
        data.filter(d => d.category === cat).forEach((d, i) => {
          if (d.type === 'point') renderMarker(d);
          else if (d.type === 'polygon') renderPolygon(d);
          const item = document.createElement('div');
          item.className = 'item';
          item.innerHTML = `<div><span class="dot" style="background:${d.color};display:inline-block"></span>${d.name}</div><span class="delete-btn" onclick="deleteItem(${d.id})">üóëÔ∏è</span>`;
          item.onclick = () => zoomTo(d);
          container.appendChild(item);
        });
      });
    }

    function renderMarker(d) {
      const el = document.createElement('div');
      el.className = 'marker';
      el.style.left = `${d.x * 100}%`;
      el.style.top = `${d.y * 100}%`;
      el.style.background = d.color;
      el.title = d.desc;
      map.appendChild(el);
    }

    function renderPolygon(d) {
      const el = document.createElement('div');
      el.className = 'polygon';
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", "100%");
      svg.style.position = 'absolute';
      svg.style.left = 0;
      svg.style.top = 0;
      svg.style.pointerEvents = 'none';
      const poly = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
      poly.setAttribute("points", d.points.map(p => `${p.x * map.clientWidth},${p.y * map.clientHeight}`).join(' '));
      poly.setAttribute("fill", d.color + '55');
      poly.setAttribute("stroke", d.color);
      svg.appendChild(poly);
      el.appendChild(svg);
      el.title = d.desc;
      map.appendChild(el);
    }

    function zoomTo(d) {
      if (d.type === 'point') {
        map.scrollTo({
          left: d.x * map.scrollWidth - map.clientWidth / 2,
          top: d.y * map.scrollHeight - map.clientHeight / 2,
          behavior: 'smooth'
        });
      } else if (d.type === 'polygon') {
        const avgX = d.points.reduce((a,b)=>a+b.x,0)/d.points.length;
        const avgY = d.points.reduce((a,b)=>a+b.y,0)/d.points.length;
        map.scrollTo({
          left: avgX * map.scrollWidth - map.clientWidth / 2,
          top: avgY * map.scrollHeight - map.clientHeight / 2,
          behavior: 'smooth'
        });
      }
    }

    function deleteItem(id) {
      data = data.filter(d => d.id !== id);
      saveData();
      renderAll();
    }

    function askDetails(type, points = null, x = null, y = null) {
      const name = prompt('N√°zev:');
      if (!name) return;
      const color = prompt('Barva (#hex nebo jm√©no):', '#00ffff');
      const desc = prompt('Popis:');
      const category = prompt('Kategorie (Lokace, √özem√≠, Dod√°vky):', 'Lokace');
      const id = Date.now();
      if (type === 'point') {
        data.push({ id, type, name, color, desc, category, x, y });
      } else {
        data.push({ id, type, name, color, desc, category, points });
      }
      saveData();
      renderAll();
    }

    map.addEventListener('dblclick', e => {
      if (e.shiftKey) {
        const rect = map.getBoundingClientRect();
        const x = (e.clientX - rect.left) / rect.width;
        const y = (e.clientY - rect.top) / rect.height;
        currentPolygon.push({ x, y });
        if (currentPolygon.length > 2 && confirm('Uzav≈ô√≠t √∫zem√≠?')) {
          askDetails('polygon', [...currentPolygon]);
          currentPolygon = [];
        }
      } else {
        const rect = map.getBoundingClientRect();
        const x = (e.clientX - rect.left) / rect.width;
        const y = (e.clientY - rect.top) / rect.height;
        askDetails('point', null, x, y);
      }
    });

    map.addEventListener('wheel', e => {
      e.preventDefault();
      const zoomIntensity = 0.1;
      scale += e.deltaY * -zoomIntensity / 100;
      scale = Math.min(Math.max(0.5, scale), 3);
      map.style.transform = `scale(${scale}) translate(${originX}px, ${originY}px)`;
    }, { passive: false });

    map.addEventListener('mousedown', e => {
      isDragging = true;
      dragStart = { x: e.clientX, y: e.clientY };
      map.style.cursor = 'grabbing';
    });
    window.addEventListener('mouseup', () => {
      isDragging = false;
      map.style.cursor = 'grab';
    });
    window.addEventListener('mousemove', e => {
      if (!isDragging) return;
      originX += (e.clientX - dragStart.x) / scale;
      originY += (e.clientY - dragStart.y) / scale;
      dragStart = { x: e.clientX, y: e.clientY };
      map.style.transform = `scale(${scale}) translate(${originX}px, ${originY}px)`;
    });

    renderAll();
  </script>
</body>
</html>
