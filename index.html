<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Archangels MC - Mapa</title>
  <style>
    html, body { margin: 0; padding: 0; height: 100%; overflow: hidden; font-family: Arial, sans-serif; background: #111; color: #fff; }
    #sidebar { position: fixed; top: 0; left: 0; bottom: 0; width: 280px; background: #1a1a1a; padding: 20px; overflow-y: auto; z-index: 10; border-right: 2px solid #222; }
    #sidebar img { display: block; margin: 0 auto 10px; max-width: 100px; }
    #sidebar h1 {
      text-align: center;
      font-size: 26px;
      font-weight: bold;
      color: red;
      text-shadow: 0 0 10px red;
      letter-spacing: 2px;
      margin-bottom: 10px;
    }
    #controls input, #controls button {
      width: 100%; margin-bottom: 5px; padding: 8px;
      background: #333; color: white; border: none;
      text-align: left;
    }
    #search { box-sizing: border-box; width: 100%; }
    .category-header {
      width: 100%; margin-bottom: 5px; padding: 8px;
      background: #333; color: white; border: none;
      font-weight: 900;
      font-size: 16px;
      cursor: pointer;
    }
    .category-items { margin-left: 10px; }
    .item { display: flex; justify-content: space-between; align-items: center; font-size: 14px; margin: 5px 0; cursor: pointer; }
    .dot { width: 10px; height: 10px; border-radius: 50%; margin-right: 8px; display: inline-block; }
    .delete-btn { color: #888; font-size: 12px; cursor: pointer; }
    #map {
      position: absolute; left: 280px; top: 0; right: 0; bottom: 0;
      background: #000 url('mapa.png') no-repeat center center;
      background-size: contain;
      cursor: grab;
      overflow: hidden;
      transform-origin: 0 0;
    }
    .marker { position: absolute; border-radius: 50%; border: 1px solid white; transform: translate(-50%, -50%); cursor: pointer; }
    .polygon-point { position: absolute; width: 8px; height: 8px; background: cyan; border: 1px solid white; border-radius: 50%; transform: translate(-50%, -50%); }
    svg.polygon { position: absolute; top: 0; left: 0; pointer-events: none; }
    .tooltip { position: absolute; background: rgba(0,0,0,0.8); color: white; padding: 4px 8px; font-size: 12px; border-radius: 4px; pointer-events: none; z-index: 99; display: none; }
  </style>
</head>
<body>
  <div id="sidebar">
    <img src="logo.png" alt="Archangels MC logo">
    <h1>Archangels MC</h1>
    <div id="controls">
      <input type="text" id="search" placeholder="üîç Hledat..." oninput="render()">
      <button onclick="setFilter('all')">Zobrazit v≈°e</button>
      <button onclick="setFilter('point')">Jen body</button>
      <button onclick="setFilter('polygon')">Jen √∫zem√≠</button>
      <button onclick="togglePlanningMode()">üìù Pl√°novat</button>
    </div>
    <div style="height: 20px;"></div>
    <div id="menu"></div>
  </div>
  <div id="map"></div>
  <div id="tooltip" class="tooltip"></div>
  <script>
    let data = JSON.parse(localStorage.getItem("mapData")) || [];
    let planningMode = false;
    let currentPolygon = [];
    let filter = "all";
    const tooltip = document.getElementById("tooltip");
    const map = document.getElementById("map");
    const menu = document.getElementById("menu");

    function save() {
      if (!planningMode) localStorage.setItem("mapData", JSON.stringify(data));
    }

    function setFilter(type) { filter = type; render(); }
    function togglePlanningMode() {
      planningMode = !planningMode;
      alert(`Pl√°novac√≠ re≈æim: ${planningMode ? 'ZAPNUT√ù' : 'VYPNUT√ù'}`);
    }

    function deleteItem(id) {
      data = data.filter(i => i.id !== id);
      save();
      render();
    }

    function render() {
      menu.innerHTML = "";
      map.querySelectorAll(".marker, .polygon-point, svg.polygon").forEach(el => el.remove());
      const cats = {
        "üìç Lokace": [], "üó∫Ô∏è √özem√≠": [], "üöö Dod√°vky": [],
        "üöó Uj√≠≈ædƒõn√≠ autem": [], "üèçÔ∏è Uj√≠≈ædƒõn√≠ na motorce": [],
        "üèÉ‚Äç‚ôÇÔ∏è √ötƒõk pƒõ≈°ky": [], "üì¶ Sklady": []
      };
      const searchValue = document.getElementById("search")?.value.toLowerCase() || "";
      for (let cat in cats) {
        const wrap = document.createElement("div");
        const h2 = document.createElement("button");
        const count = data.filter(i => i.categories?.includes(cat)).length;
        h2.textContent = `${cat} (${count})`;
        h2.className = "category-header";
        h2.onclick = () => { filter = cat; render(); };

        const items = document.createElement("div");
        items.className = "category-items";

        data.forEach(item => {
          const matchesFilter = filter === "all" || item.type === filter || item.categories?.includes(filter);
          if (matchesFilter && item.categories?.includes(cat)) {
            if (item.name?.toLowerCase().includes(searchValue)) {
              if (item.type === "point") renderMarker(item);
              if (item.type === "polygon") renderPolygon(item);
              const div = document.createElement("div");
              div.className = "item";
              const nameEl = document.createElement("div");
              nameEl.innerHTML = `<span class='dot' style='background:${item.color}'></span>${item.name}`;
              const delBtn = document.createElement("span");
              delBtn.className = "delete-btn";
              delBtn.innerHTML = "üóë";
              delBtn.onclick = (e) => {
                e.stopPropagation();
                deleteItem(item.id);
              };
              div.appendChild(nameEl);
              div.appendChild(delBtn);
              items.appendChild(div);
            }
          }
        });

        wrap.appendChild(h2);
        wrap.appendChild(items);
        menu.appendChild(wrap);
      }
    }

    // ... ostatn√≠ funkce z≈Øst√°vaj√≠ stejn√© (renderMarker, renderPolygon atd.)

    window.onload = () => render();
  </script>
</body>
</html>
