<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Archangels MC - Mapa</title>
  <style>
    html, body { margin: 0; padding: 0; height: 100%; overflow: hidden; font-family: Arial, sans-serif; background: #111; color: #fff; }
    #sidebar { position: fixed; top: 0; left: 0; bottom: 0; width: 280px; background: #1a1a1a; padding: 20px; overflow-y: auto; z-index: 10; border-right: 2px solid #222; }
    #sidebar img { display: block; margin: 0 auto 10px; max-width: 200px; }
    #sidebar h1 { text-align: center; font-size: 20px; color: #ff5050; margin-bottom: 20px; }
    #controls button { width: 100%; margin-bottom: 5px; padding: 8px; background: #222; color: white; border: none; cursor: pointer; }
    .category h2 { cursor: pointer; font-size: 16px; border-bottom: 1px solid #333; padding: 6px 0; margin-top: 15px; }
    .category-items { display: none; margin-left: 10px; }
    .item { display: flex; justify-content: space-between; align-items: center; font-size: 14px; margin: 5px 0; cursor: pointer; }
    .dot { width: 10px; height: 10px; border-radius: 50%; margin-right: 8px; display: inline-block; }
    .delete-btn { color: #888; font-size: 12px; cursor: pointer; }
    #map { position: absolute; left: 280px; top: 0; right: 0; bottom: 0; background: #000 url('mapa.png') no-repeat center center; background-size: contain; cursor: grab; overflow: hidden; }
    .marker { position: absolute; width: 8px; height: 8px; border-radius: 50%; border: 2px solid white; transform: translate(-50%, -50%); cursor: pointer; }
    .polygon-point { position: absolute; width: 8px; height: 8px; background: cyan; border: 1px solid white; border-radius: 50%; transform: translate(-50%, -50%); }
    svg.polygon { position: absolute; top: 0; left: 0; pointer-events: none; }
    .tooltip { position: absolute; background: rgba(0,0,0,0.8); color: white; padding: 4px 8px; font-size: 12px; border-radius: 4px; pointer-events: none; z-index: 99; }
  </style>
</head>
<body>
  <div id="sidebar">
    <img src="https://media.discordapp.net/attachments/1317483184429989994/1320522537100378202/image.png?format=webp&quality=lossless">
    <h1>Archangels MC</h1>
    <div id="controls">
      <button onclick="setFilter('all')">Zobrazit v≈°e</button>
      <button onclick="setFilter('point')">Jen body</button>
      <button onclick="setFilter('polygon')">Jen √∫zem√≠</button>
      <button onclick="togglePlanningMode()">üìù Pl√°novat</button>
    </div>
    <div id="menu"></div>
  </div>
  <div id="map"></div>
  <script>
    // Kompletn√≠ JavaScript ‚Äì odlehƒçen√° verze z pln√©ho script.js kv≈Øli m√≠stu
    let data = JSON.parse(localStorage.getItem("mapData") || "[]");
    let planningMode = false;
    let currentPolygon = [];
    let filter = "all";

    const map = document.getElementById("map");
    const menu = document.getElementById("menu");

    function save() {
      if (!planningMode) localStorage.setItem("mapData", JSON.stringify(data));
    }

    function setFilter(type) { filter = type; render(); }
    function togglePlanningMode() {
      planningMode = !planningMode;
      alert(\`Pl√°novac√≠ re≈æim: \${planningMode ? 'ZAPNUT√ù' : 'VYPNUT√ù'}\`);
    }

    function render() {
      menu.innerHTML = "";
      map.querySelectorAll(".marker, .polygon-point, svg.polygon").forEach(el => el.remove());
      const cats = { "Lokace": [], "√özem√≠": [], "Dod√°vky": [], "M√≠sta na uj√≠≈ædƒõn√≠ PD": ["autem", "na motorce", "pƒõ≈°ky"] };
      for (let cat in cats) {
        const wrap = document.createElement("div"), h2 = document.createElement("h2");
        h2.textContent = cat;
        h2.onclick = () => items.style.display = items.style.display === "block" ? "none" : "block";
        const items = document.createElement("div"); items.className = "category-items";
        const subcats = cats[cat].length ? cats[cat] : [null];
        subcats.forEach(sub => {
          data.forEach(item => {
            if ((filter === "all" || filter === item.type) && item.categories?.includes(cat) && (!sub || item.categories.includes(sub))) {
              item.type === "point" && renderMarker(item);
              item.type === "polygon" && renderPolygon(item);
              const div = document.createElement("div");
              div.className = "item";
              div.innerHTML = \`<div><span class="dot" style="background:\${item.color}"></span>\${item.name}</div><span class="delete-btn" onclick="deleteItem(\${item.id}); event.stopPropagation()">üóë</span>\`;
              div.onclick = () => centerTo(item);
              items.appendChild(div);
            }
          });
        });
        wrap.appendChild(h2); wrap.appendChild(items); menu.appendChild(wrap);
      }
    }

    function renderMarker(item) {
      const el = document.createElement("div");
      el.className = "marker";
      el.style.left = \`\${item.x * 100}%\`;
      el.style.top = \`\${item.y * 100}%\`;
      el.style.background = item.color;
      el.title = item.desc;
      map.appendChild(el);
    }

    function renderPolygon(item) {
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.classList.add("polygon");
      svg.setAttribute("width", map.clientWidth);
      svg.setAttribute("height", map.clientHeight);
      const poly = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
      poly.setAttribute("points", item.points.map(p => \`\${p.x * map.clientWidth},\${p.y * map.clientHeight}\`).join(" "));
      poly.setAttribute("fill", item.color + "55");
      poly.setAttribute("stroke", item.color);
      svg.appendChild(poly);
      map.appendChild(svg);
    }

    function centerTo(item) {
      const x = item.type === "point" ? item.x : item.points.reduce((a, b) => a + b.x, 0) / item.points.length;
      const y = item.type === "point" ? item.y : item.points.reduce((a, b) => a + b.y, 0) / item.points.length;
      map.scrollTo({ left: x * map.scrollWidth - map.clientWidth / 2, top: y * map.scrollHeight - map.clientHeight / 2, behavior: "smooth" });
    }

    function deleteItem(id) {
      data = data.filter(i => i.id !== id);
      save(); render();
    }

    function openForm(type, coords) {
      const name = prompt("N√°zev:"); if (!name) return;
      const desc = prompt("Popis:");
      const color = prompt("Barva:", "#00ffff");
      const cats = ["Lokace", "√özem√≠", "Dod√°vky", "M√≠sta na uj√≠≈ædƒõn√≠ PD", "autem", "na motorce", "pƒõ≈°ky"];
      const selectedCats = cats.filter(c => confirm(\`Za≈ôadit do ‚Äû\${c}‚Äú?\`));
      const item = { id: Date.now(), type, name, desc, color, categories: selectedCats };
      if (type === "point") { item.x = coords.x; item.y = coords.y; } else { item.points = [...coords]; }
      if (!planningMode) data.push(item);
      save(); render();
    }

    map.addEventListener("dblclick", e => {
      if (e.shiftKey) return;
      const r = map.getBoundingClientRect(), x = (e.clientX - r.left) / r.width, y = (e.clientY - r.top) / r.height;
      openForm("point", { x, y });
    });

    map.addEventListener("click", e => {
      if (!e.shiftKey) return;
      const r = map.getBoundingClientRect(), x = (e.clientX - r.left) / r.width, y = (e.clientY - r.top) / r.height;
      currentPolygon.push({ x, y });
      const point = document.createElement("div");
      point.className = "polygon-point";
      point.style.left = \`\${x * 100}%\`;
      point.style.top = \`\${y * 100}%\`;
      map.appendChild(point);
      if (currentPolygon.length > 2 && confirm("Uzav≈ô√≠t √∫zem√≠?")) {
        openForm("polygon", currentPolygon);
        currentPolygon = [];
        document.querySelectorAll(".polygon-point").forEach(el => el.remove());
      }
    });

    let scale = 1, originX = 0, originY = 0, isDragging = false, start = { x: 0, y: 0 };
    map.addEventListener("wheel", e => {
      e.preventDefault();
      scale += e.deltaY * -0.001;
      scale = Math.min(Math.max(0.5, scale), 6);
      map.style.transform = \`scale(\${scale}) translate(\${originX}px, \${originY}px)\`;
    }, { passive: false });

    map.addEventListener("mousedown", e => { isDragging = true; start = { x: e.clientX, y: e.clientY }; });
    window.addEventListener("mouseup", () => isDragging = false);
    window.addEventListener("mousemove", e => {
      if (!isDragging) return;
      originX += (e.clientX - start.x) / scale;
      originY += (e.clientY - start.y) / scale;
      start = { x: e.clientX, y: e.clientY };
      map.style.transform = \`scale(\${scale}) translate(\${originX}px, \${originY}px)\`;
    });

    window.onload = () => render();
  </script>
</body>
</html>
